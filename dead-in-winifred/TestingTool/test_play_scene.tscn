[gd_scene load_steps=13 format=3 uid="uid://cvq280sj7m43r"]

[ext_resource type="PackedScene" uid="uid://so68gwvvuap2" path="res://MainTool/player.tscn" id="1_54lxw"]
[ext_resource type="PackedScene" uid="uid://dpxk2n83pvoo5" path="res://MainTool/speak.tscn" id="1_schkm"]
[ext_resource type="Texture2D" uid="uid://cp0is0ctncclu" path="res://sprites by judas la carotte/sprite1 sad small.png" id="3_btmwu"]
[ext_resource type="Script" uid="uid://bxyenkwbig6w7" path="res://TestingTool/ava.gd" id="4_netb3"]
[ext_resource type="PackedScene" uid="uid://202whtl45tqd" path="res://MainTool/phone.tscn" id="5_netb3"]

[sub_resource type="GDScript" id="GDScript_54lxw"]
script/source = "extends Node2D

## ---------------------------------------------------------------------------##

#Copy and paste the following code into other important scenes to reduce coding time:

@onready var e = $Player/RemoteTransform2D/Emote  #emotes / screen animations
@onready var speak = $GUI/Speak  #textbox text, name, and sprite

@onready var em = speak.emotion  #textbox text, name, and sprite

@onready var player = $Player #body
@onready var phone = $GUI/phone #body

@onready var player_body = $Player/area #body
@onready var ava = $AVA/area #me lol

var can_interact: bool  = true

signal release

func say( message: String ):
	await check_phone()
	await speak.say(message)

func stop():
	player.can_move = false
	can_interact = false
	await release
	player.can_move = true
	can_interact = true

func done():
	emit_signal(\"release\")
	phone.has_access = true
	
func check_phone():
	if phone.up:
		phone.a.play(\"Away\")
		phone.up = false
		await phone.a.animation_finished
	
	phone.has_access = false

## ---------------------------------------------------------------------------##




# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	if Input.is_action_just_pressed(\"interact\") and can_interact:
		if ava.overlaps_area(player_body):
			AVA_interact()
			print(\"debug\")

func AVA_interact():
	stop()
	
	speak.name_label = \"Ava Bisset\"
	speak.emotion = \"angry\"
	
	e.play(\"shake\")
	await say(\"Don't talk to me!\")
	
	
	speak.emotion = \"sad\"
	await say(\"I know what you did.\")
	
	done()

func wait(seconds: float) -> void:
	await get_tree().create_timer(seconds).timeout
"

[sub_resource type="Animation" id="Animation_schkm"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Player/RemoteTransform2D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, 0)]
}

[sub_resource type="Animation" id="Animation_btmwu"]
length = 1.009
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Player/RemoteTransform2D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4, 0.66, 1.009),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, 0), Vector2(0, -20), Vector2(0, 20), Vector2(0, 0)]
}

[sub_resource type="Animation" id="Animation_lhsc1"]
resource_name = "slide_down"
length = 0.626
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Player/RemoteTransform2D:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2, 0.43333334, 0.6),
"transitions": PackedFloat32Array(1, 1, 0.40612698, 3.1383355),
"update": 0,
"values": [Vector2(0, 0), Vector2(-57, 0), Vector2(67, 0), Vector2(0, 0)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_btmwu"]
_data = {
&"RESET": SubResource("Animation_schkm"),
&"anger": SubResource("Animation_btmwu"),
&"shake": SubResource("Animation_lhsc1")
}

[sub_resource type="CircleShape2D" id="CircleShape2D_xck7t"]
radius = 502.4605

[sub_resource type="RectangleShape2D" id="RectangleShape2D_sbxu3"]
size = Vector2(277.21204, 765.5268)

[node name="Test_PlayScene" type="Node2D"]
script = SubResource("GDScript_54lxw")

[node name="ColorRect" type="ColorRect" parent="."]
offset_left = -1211.0
offset_top = -1297.0
offset_right = 1238.0
offset_bottom = 2035.0
color = Color(0.3882353, 0.40392157, 1, 1)

[node name="Camera2D" type="Camera2D" parent="."]
limit_left = -1200
limit_top = -1270
limit_right = 1200
limit_bottom = 1970
limit_smoothed = true
position_smoothing_enabled = true

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="Camera2D"]
remote_path = NodePath("../../GUI/Speak")
use_global_coordinates = false
update_position = false
update_rotation = false

[node name="Player" parent="." instance=ExtResource("1_54lxw")]

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="Player"]
remote_path = NodePath("../../Camera2D")

[node name="Emote" type="AnimationPlayer" parent="Player/RemoteTransform2D"]
root_node = NodePath("../../../Camera2D")
libraries = {
&"": SubResource("AnimationLibrary_btmwu")
}

[node name="area" type="Area2D" parent="Player"]
position = Vector2(0, -1.5258789e-05)
scale = Vector2(0.14595146, 0.14595146)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Player/area"]
shape = SubResource("CircleShape2D_xck7t")

[node name="GUI" type="CanvasLayer" parent="."]

[node name="Speak" parent="GUI" instance=ExtResource("1_schkm")]

[node name="phone" parent="GUI" instance=ExtResource("5_netb3")]
z_index = 3

[node name="AVA" type="Sprite2D" parent="."]
position = Vector2(-285, -243)
scale = Vector2(0.14595146, 0.14595146)
texture = ExtResource("3_btmwu")
script = ExtResource("4_netb3")

[node name="CollisionShape2D" type="CollisionShape2D" parent="AVA"]
position = Vector2(-20.55481, -0.92578125)
shape = SubResource("RectangleShape2D_sbxu3")

[node name="area" type="Area2D" parent="AVA"]
position = Vector2(-20.55481, -0.92578125)
scale = Vector2(0.14595146, 0.14595146)

[node name="CollisionShape2D" type="CollisionShape2D" parent="AVA/area"]
scale = Vector2(15.462021, 15.214303)
shape = SubResource("CircleShape2D_xck7t")
